{"version":3,"sources":["Game.js"],"names":["cc","Class","extends","Component","properties","options","Node","wangfa","Label","dipai8","Sprite","dipai9","settingWin","menuWin","_seatComponent","_myHoldPokers","_myFoldPokers","onLoad","addComponent","initView","initSeats","initEventHandlers","initWanfaLabel","initDipai","th","audioManager","playBGM","seatNames","i","length","socketIOManager","seats","seatComponent","node","getChildByName","getComponent","push","myholds","holds","j","children","sprite","spriteFrame","hideOptions","initSingleSeat","seat","index","getLocalIndex","setInfo","userId","name","score","headImgUrl","setFangzhu","creator","setReady","ready","setOffline","online","self","dataEventHandler","on","target","console","log","JSON","stringify","detail","seatIndex","getSeatIndexById","string","getWanfa","dipai","getDipai","active","data","child","onMenuClicked","onBtnDissolveRequestClicked","alert","show","sio","send","onBtnDissolveClicked","onBtnLeaveClicked","isFangzhu","onBtnSettingClicked","onChatClicked","onVoiceClicked"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        options:cc.Node,\r\n        wangfa:cc.Label,\r\n        dipai8:cc.Sprite,\r\n        dipai9:cc.Sprite,\r\n\r\n        settingWin:cc.Node,\r\n        menuWin:cc.Node,\r\n\r\n        _seatComponent:[],\r\n        _myHoldPokers:[],\r\n        _myFoldPokers:[]\r\n    },\r\n\r\n    onLoad () {\r\n\r\n        this.addComponent(\"Folds\");\r\n\r\n        this.initView();\r\n        this.initSeats();\r\n        this.initEventHandlers();\r\n        this.initWanfaLabel();\r\n        this.initDipai();\r\n        th.audioManager.playBGM(\"bg_fight.mp3\");\r\n    },\r\n\r\n    initView:function(){\r\n        var seatNames = [\"myself\",\"right\",\"up\",\"left\"];\r\n        for(var i=0;i<seatNames.length;i++){\r\n            if(i==2&&th.socketIOManager.seats.length==3){\r\n                continue;\r\n            }\r\n            var seatComponent=this.node.getChildByName(seatNames[i]).getChildByName('Seat').getComponent('Seat');\r\n            this._seatComponent.push(seatComponent);\r\n        }\r\n\r\n\r\n        var myholds=['Holds1','Holds2'];\r\n        for(var i=0;i<myholds.length;i++){\r\n            var holds = this.node.getChildByName('myself').getChildByName(myholds[i]);\r\n            for(var j=0;j<holds.children.length;j++){\r\n                var sprite = holds.children[j].getComponent(cc.Sprite);\r\n                this._myHoldPokers.push(sprite);\r\n                sprite.spriteFrame = null;\r\n            }\r\n        }\r\n        //this.initDragStuffs(sprite.node);\r\n        //cc.log(\"mypokers:\"+this._myHoldPokers.length);\r\n        //var realwidth = cc.director.getVisibleSize().width;\r\n        //cc.log(\"realWidth:\"+(realwidth/1280));\r\n\r\n        this.hideOptions();\r\n    },\r\n\r\n    initSeats:function(){\r\n        var seats=th.socketIOManager.seats;\r\n        for(var i = 0; i < seats.length; ++i){\r\n            this.initSingleSeat(seats[i]);\r\n        }\r\n    },\r\n\r\n    initSingleSeat:function(seat){\r\n        var index = th.socketIOManager.getLocalIndex(seat.index);\r\n        this._seatComponent[index].setInfo(seat.userId,seat.name,seat.score,seat.headImgUrl);\r\n        this._seatComponent[index].setFangzhu(seat.userId==th.socketIOManager.creator);\r\n        this._seatComponent[index].setReady(seat.ready);\r\n        this._seatComponent[index].setOffline(!seat.online);\r\n    },\r\n    \r\n\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        th.socketIOManager.dataEventHandler=this.node;\r\n\r\n        this.node.on('init_room', function (target) {\r\n            console.log('==>Gmae init_room:',JSON.stringify(target.detail));\r\n        });\r\n        //加入房间\r\n        this.node.on('join_push', function (target) {\r\n            console.log('==>Gmae join_push:',JSON.stringify(target.detail));\r\n            self.initSingleSeat(target.detail);\r\n        });\r\n\r\n        //检查IP\r\n        this.node.on('check_ip', function (target) {\r\n            console.log('==>Gmae check_ip:',JSON.stringify(target.detail));\r\n        });\r\n\r\n        //离开房间\r\n        this.node.on('leave_push', function (target) {\r\n            console.log('==>Gmae leave_push:',JSON.stringify(target.detail));\r\n            self.initSingleSeat(target.detail);\r\n        });\r\n\r\n         //解散房间\r\n        this.node.on('dissolve_push', function (target) {\r\n            console.log('==>Gmae dissolve_push:',JSON.stringify(target.detail));\r\n            \r\n        });\r\n        //其他玩家断线\r\n        this.node.on(\"offline_push\",function(target){\r\n            console.log('==>Gmae offline_push:',JSON.stringify(target.detail));\r\n            var seatIndex=th.socketIOManager.getSeatIndexById(target.detail.userId)\r\n            var index = th.socketIOManager.getLocalIndex(seatIndex);\r\n            self._seatComponent[index].setOffline(true);\r\n        })\r\n        //其他玩家上线\r\n        this.node.on(\"online_push\",function(target){\r\n            console.log('==>Gmae online_push:',JSON.stringify(target.detail));\r\n            var seatIndex=th.socketIOManager.getSeatIndexById(target.detail.userId)\r\n            var index = th.socketIOManager.getLocalIndex(seatIndex);\r\n            self._seatComponent[index].setOffline(false);\r\n        })\r\n        //断线\r\n        this.node.on('disconnect', function (target) {\r\n            console.log('==>Gmae disconnect:',JSON.stringify(target.detail));\r\n        });\r\n        \r\n\r\n    },\r\n\r\n    initWanfaLabel:function(){\r\n        this.wangfa.string=th.socketIOManager.getWanfa();\r\n    },\r\n    initDipai:function(){\r\n        var dipai=th.socketIOManager.getDipai();\r\n        if(dipai==8){\r\n            this.dipai8.node.active=true;\r\n            this.dipai9.node.active=false;\r\n        }else if(dipai==9){\r\n            this.dipai8.node.active=false;\r\n            this.dipai9.node.active=true;\r\n        }else{\r\n            this.dipai8.node.active=false;\r\n            this.dipai9.node.active=false;\r\n        }\r\n    },\r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n\r\n    hideOptions:function(data){\r\n        this.options.active=false;\r\n        for(var i=0;i<this.options.children.length;i++){\r\n            var child = this.options.children[i]; \r\n            child.active=false;\r\n        }\r\n    },\r\n\r\n    onMenuClicked:function(){\r\n        this.menuWin.active=!this.menuWin.active;\r\n    },\r\n    onBtnDissolveRequestClicked:function(){\r\n        this.menuWin.active=false;\r\n        th.alert.show(\"申请解散房间\",\"申请解散房间不会退换钻石，是否确定申请解散？\",function(){\r\n            th.sio.send(\"dissolve_request\"); \r\n        },true)\r\n    },\r\n    onBtnDissolveClicked:function(){\r\n        this.menuWin.active=false;\r\n        th.alert.show(\"解散房间\",\"解散房间不扣钻石，是否确定解散？\",function(){\r\n            th.sio.send(\"dissolve\"); \r\n        },true)\r\n    },\r\n    onBtnLeaveClicked:function(){\r\n        this.menuWin.active=false;\r\n        if(th.socketIOManager.isFangzhu()){\r\n            th.alert.show(\"离开房间\",\"您是房主，不能离开房间。\",function(){\r\n                //th.sio.send(\"leave\"); \r\n            })\r\n            return ;\r\n        }\r\n        th.alert.show(\"离开房间\",\"您确定要离开房间?\",function(){\r\n            th.sio.send(\"leave\"); \r\n        },true)\r\n    },\r\n    onBtnSettingClicked:function(){\r\n        this.menuWin.active=false;\r\n        this.settingWin.active=true;\r\n    },\r\n    onChatClicked:function(){\r\n        cc.log('onChatClicked==>');\r\n    },\r\n    onVoiceClicked:function(){\r\n        cc.log('onVoiceClicked==>');\r\n    },\r\n\r\n\r\n});\r\n"]}