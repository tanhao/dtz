{"version":3,"sources":["SocketIOManager.js"],"names":["cc","Class","extends","Component","properties","dataEventHandler","roomId","config","seats","round","seatIndex","onLoad","dispatchEvent","event","data","emit","initHandlers","self","th","sio","addHandler","log","JSON","stringify","getSeatIndexById","userManager","userId","i","length","connectServer","onConnectSuccess","director","loadScene","wc","hide","onConnectError","err","alert","show","addr","ip","port","token","sign","time","connect"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,0BAAiB,IADT,EACe;AACvBC,gBAAO,IAFC;AAGRC,gBAAO,IAHC;AAIRC,eAAM,IAJE;AAKRC,eAAM,CALE;AAMRC,mBAAU,CAAC;AANH,KAHP;;AAYLC,UAZK,oBAYK,CAET,CAdI;;;AAgBL;;;;;AAKAC,iBArBK,yBAqBSC,KArBT,EAqBeC,IArBf,EAqBoB;AACrB,YAAG,KAAKT,gBAAR,EAAyB;AACrB,iBAAKA,gBAAL,CAAsBU,IAAtB,CAA2BF,KAA3B,EAAiCC,IAAjC;AACH;AACJ,KAzBI;;;AA2BLE,kBAAa,wBAAU;AACnB,YAAIC,OAAO,IAAX;AACAC,WAAGC,GAAH,CAAOC,UAAP,CAAkB,WAAlB,EAA8B,UAASN,IAAT,EAAc;AACxCd,eAAGqB,GAAH,CAAO,eAAP,EAAuBC,KAAKC,SAAL,CAAeT,IAAf,CAAvB;AACAG,iBAAKX,MAAL,GAAYQ,KAAKR,MAAjB;AACAW,iBAAKV,MAAL,GAAYO,KAAKP,MAAjB;AACAU,iBAAKT,KAAL,GAAWM,KAAKN,KAAhB;AACAS,iBAAKR,KAAL,GAAWK,KAAKL,KAAhB;AACAQ,iBAAKP,SAAL,GAAec,iBAAiBN,GAAGO,WAAH,CAAeC,MAAhC,CAAf;AACAT,iBAAKL,aAAL,CAAmB,WAAnB,EAA+BE,IAA/B;AACH,SARD;AAUH,KAvCI;;AAyCLU,sBAAiB,0BAASE,MAAT,EAAgB;AAC7B,aAAI,IAAIC,IAAI,CAAZ,EAAeA,IAAI,KAAKnB,KAAL,CAAWoB,MAA9B,EAAqCD,GAArC,EAAyC;AACrC,gBAAG,KAAKnB,KAAL,CAAWmB,CAAX,EAAcD,MAAd,IAAwBA,MAA3B,EAAkC;AAC9B,uBAAOC,CAAP;AACH;AACJ;AACD,eAAO,CAAC,CAAR;AACH,KAhDI;;AAkDLE,mBAAc,uBAASf,IAAT,EAAc;AACxB,YAAIgB,mBAAiB,SAAjBA,gBAAiB,GAAU;AAC3B9B,eAAG+B,QAAH,CAAYC,SAAZ,CAAsB,MAAtB,EAA6B,YAAU;AACnCd,mBAAGe,EAAH,CAAMC,IAAN;AACH,aAFD;AAGH,SAJD;;AAMA,YAAIC,iBAAe,SAAfA,cAAe,CAASC,GAAT,EAAa;AAC3BlB,eAAGe,EAAH,CAAMC,IAAN;AACAhB,eAAGmB,KAAH,CAASC,IAAT,CAAc,IAAd,EAAmBF,GAAnB,EAAuB,IAAvB,EAA4B,KAA5B,EAF2B,CAES;AACxC,SAHD;AAIAlB,WAAGC,GAAH,CAAOoB,IAAP,GAAY,UAAQzB,KAAK0B,EAAb,GAAgB,GAAhB,GAAoB1B,KAAK2B,IAAzB,GAA8B,UAA9B,GAAyC3B,KAAKR,MAA9C,GAAqD,SAArD,GAA+DQ,KAAK4B,KAApE,GAA0E,QAA1E,GAAmF5B,KAAK6B,IAAxF,GAA6F,QAA7F,GAAsG7B,KAAK8B,IAAvH;AACA1B,WAAGC,GAAH,CAAO0B,OAAP,CAAef,gBAAf,EAAgCK,cAAhC;AACH;;AA/DI,CAAT","file":"SocketIOManager.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        dataEventHandler:null, //处理socket.io发过来的数据的节点\r\n        roomId:null,\r\n        config:null,\r\n        seats:null,\r\n        round:0,\r\n        seatIndex:-1,\r\n    },\r\n\r\n    onLoad () {\r\n      \r\n    },\r\n\r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n\r\n    dispatchEvent(event,data){\r\n        if(this.dataEventHandler){\r\n            this.dataEventHandler.emit(event,data);\r\n        }    \r\n    },\r\n\r\n    initHandlers:function(){\r\n        var self = this;\r\n        th.sio.addHandler(\"init_info\",function(data){\r\n            cc.log(\"==>init_info:\",JSON.stringify(data));\r\n            self.roomId=data.roomId;\r\n            self.config=data.config;\r\n            self.seats=data.seats;\r\n            self.round=data.round;\r\n            self.seatIndex=getSeatIndexById(th.userManager.userId);\r\n            self.dispatchEvent(\"init_info\",data);\r\n        })\r\n       \r\n    },\r\n\r\n    getSeatIndexById:function(userId){\r\n        for(var i = 0; i < this.seats.length;i++){\r\n            if(this.seats[i].userId == userId){\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    },\r\n\r\n    connectServer:function(data){\r\n        var onConnectSuccess=function(){\r\n            cc.director.loadScene(\"game\",function(){\r\n                th.wc.hide();\r\n            });\r\n        }\r\n\r\n        var onConnectError=function(err){\r\n             th.wc.hide();\r\n             th.alert.show('提示',err,null,false); //\r\n        }\r\n        th.sio.addr=\"ws://\"+data.ip+\":\"+data.port+\"?roomId=\"+data.roomId+\"&token=\"+data.token+\"&sign=\"+data.sign+\"&time=\"+data.time;\r\n        th.sio.connect(onConnectSuccess,onConnectError);\r\n    }\r\n    \r\n\r\n});\r\n"]}