{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\SocketIOManager.js"],"names":["cc","Class","extends","Component","properties","dataEventHandler","roomId","config","seats","round","seatIndex","onLoad","dispatchEvent","event","data","emit","initHandlers","self","th","sio","addHandler","log","JSON","stringify","getSeatIndexById","userManager","userId","i","length","getWanfa","str","push","peoples","score","gift","join","getDipai","liudipai","connectServer","onConnectSuccess","director","loadScene","ping","wc","hide","onConnectError","err","alert","show","addr","ip","port","token","sign","time","connect"],"mappings":"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","file":"SocketIOManager.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        dataEventHandler:null, //处理socket.io发过来的数据的节点\r\n        roomId:null,\r\n        config:null,\r\n        seats:null,\r\n        round:null,\r\n        seatIndex:-1,\r\n    },\r\n\r\n\r\n    onLoad () {\r\n\r\n    },\r\n\r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n\r\n    dispatchEvent(event,data){\r\n        if(this.dataEventHandler){\r\n            this.dataEventHandler.emit(event,data);\r\n        }    \r\n    },\r\n\r\n    initHandlers:function(){\r\n        var self = this;\r\n        //连接成功初始化信息\r\n        th.sio.addHandler(\"init_room\",function(data){\r\n            cc.log(\"==>SocketIOManager init_room:\",JSON.stringify(data));\r\n            self.roomId=data.roomId;\r\n            self.config=data.config;\r\n            self.seats=data.seats;\r\n            self.round=data.round;\r\n            self.seatIndex=self.getSeatIndexById(th.userManager.userId);\r\n            self.dispatchEvent(\"init_room\",data);\r\n        })\r\n        //其他玩家加入房间\r\n        th.sio.addHandler(\"join_push\",function(data){\r\n            cc.log(\"==>SocketIOManager init_room:\",JSON.stringify(data));\r\n            self.dispatchEvent(\"join_push\",data);\r\n        })\r\n\r\n        //其他玩家离开房间\r\n        th.sio.addHandler(\"leave_push\",function(data){\r\n            cc.log(\"==>SocketIOManager leave_push:\",JSON.stringify(data));\r\n            self.dispatchEvent(\"leave_push\",data);\r\n        })\r\n\r\n        //解散房间，所有玩家退出房间，收到此消息返回大厅\r\n        th.sio.addHandler(\"dissolve_push\",function(data){\r\n            cc.log(\"==>SocketIOManager dissolve_push:\",JSON.stringify(data));\r\n            self.dispatchEvent(\"dissolve_push\",data);\r\n        })\r\n       \r\n    },\r\n\r\n    getSeatIndexById:function(userId){\r\n        for(var i = 0; i < this.seats.length;i++){\r\n            if(this.seats[i].userId == userId){\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    },\r\n\r\n    getWanfa:function(){\r\n        /*\r\n        {\"roomId\":293935,\"config\":{\"peoples\":4,\"score\":1000,\"fee\":1,\"gift\":100,\"liudipai\":false,\"jipaiqi\":false},\"round\":1,\r\n        \"seats\":[{\"userId\":null,\"name\":null,\"headImgUrl\":null,\"sex\":null,\"score\":0,\"ready\":false,\"online\":false,\"index\":0},\r\n          {\"userId\":\"100000\",\"name\":\"zhiyuan\",\"headImgUrl\":\"http://thirdwx.qlogo.cn/mmopen/vi_32/yRMlybhILtPMrSOz5Bo7zkF94HEaJqYE6hZvaPpGAqlJnJO0sjSJ2lJqhZiaFcSrLNaicfYzDbbtPySaQCxJxCUg/132\",\"sex\":\"1\",\"score\":0,\"ready\":false,\"online\":true,\"index\":1,\"ip\":\"127.0.0.1\"},\r\n          {\"userId\":null,\"name\":null,\"headImgUrl\":null,\"sex\":null,\"score\":0,\"ready\":false,\"online\":false,\"index\":2},\r\n          {\"userId\":null,\"name\":null,\"headImgUrl\":null,\"sex\":null,\"score\":0,\"ready\":false,\"online\":false,\"index\":3}]}\r\n        */\r\n       var str=[];\r\n       str.push(this.config.peoples)\r\n       str.push(\"人\");\r\n       str.push(\" 结算\");\r\n       str.push(this.config.score)\r\n       str.push(\" 奖励\");\r\n       str.push(this.config.gift)\r\n       return str.join(\"\");\r\n    },\r\n    getDipai:function(){\r\n        return this.config.liudipai?(peoples==4?8:(peoples==3?9:0)):0;  \r\n    },\r\n\r\n    connectServer:function(data){\r\n        var onConnectSuccess=function(){\r\n            cc.director.loadScene(\"game\",function(){\r\n                th.sio.ping();\r\n                th.wc.hide();\r\n            });\r\n        }\r\n\r\n        var onConnectError=function(err){\r\n             th.wc.hide();\r\n             th.alert.show('提示',err,null,false); //\r\n        }\r\n        th.sio.addr=\"ws://\"+data.ip+\":\"+data.port+\"?roomId=\"+data.roomId+\"&token=\"+data.token+\"&sign=\"+data.sign+\"&time=\"+data.time;\r\n        th.sio.connect(onConnectSuccess,onConnectError);\r\n    }\r\n    \r\n\r\n});\r\n"]}